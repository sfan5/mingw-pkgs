#!/bin/bash -eu

. ./common.sh
common_init "$@"

pkgver=1.6.29
fetch_web "http://downloads.sourceforge.net/sourceforge/libpng/libpng-$pkgver.tar.xz" \
	4245b684e8fe829ebb76186327bb37ce5a639938b219882b53d64bd3cfc5f239
unpack_tar "libpng-$pkgver.tar.xz" --strip-components=1

zlibpath=$(depend_get_path zlib)
CFLAGS=-I$zlibpath/include LDFLAGS="-L$zlibpath/lib -lwinpthread" \
./configure --host=$MINGW_PREFIX --prefix=/
sed '/^#am__append_9/ s|.*|am__append_9 = $(CFLAGS)|' -i Makefile
make

make DESTDIR=$INSTALL_DIR install
rm -rf $INSTALL_DIR/{share,lib/*.la,lib/pkgconfig} # no manpages or pkg-config on windows

package $pkgver
