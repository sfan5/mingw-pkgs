#!/bin/bash -eu

. ./common.sh
common_init "$@"

pkgver=2.1.0-beta3
fetch_web "http://luajit.org/download/LuaJIT-$pkgver.tar.gz" \
	1ad2e34b111c802f9d0cdf019e986909123237a28c746b21295b63c9e785d9c3
unpack_tar "LuaJIT-$pkgver.tar.gz" --strip-components=1

# this assumes a 64-bit host os
if [[ "$MINGW_PREFIX" == "x86_64-"* ]]; then
	extra=
else
	extra=-m32
fi
make \
	HOST_CC="gcc $extra" BUILDMODE=static \
	CROSS=$MINGW_PREFIX- TARGET_SYS=Windows \
	amalg

mkdir -p $INSTALL_DIR/include
cp src/*.h $INSTALL_DIR/include
cp src/luajit.exe src/libluajit.a $INSTALL_DIR

package $pkgver
